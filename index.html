<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <!-- Make sure this path is correct for your setup -->
    <link rel="icon" href="/Portfolio/assets/favicon-C9MESCF-.svg" type="image/svg+xml" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Saqin's Portfolio</title>
    <!-- Link to the main CSS generated by Vite -->
    <link rel="stylesheet" crossorigin href="/Portfolio/assets/index-C0F9DEmS.css" id="main-css">
    <!-- Inline styles for the loader - Apply immediately -->
    <style>
      /* Prevents flash of unstyled content (FOUC) for the loader */
      #loader-overlay {
        position: fixed;
        inset: 0; /* top, right, bottom, left = 0 */
        background-color: #0a0a0a; /* Darker black */
        z-index: 10000; /* High z-index */
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: 'Courier New', monospace;
        color: #00ff00;
        overflow: hidden;
        opacity: 1;
        transition: opacity 0.6s ease-out 0.3s; /* Slightly slower fade */
      }
      body.loaded #loader-overlay {
        opacity: 0;
        pointer-events: none; /* Allow clicks through after hidden */
      }

      /* Loader CRT Effects */
      #loader-overlay::before { /* Noise/Grain */
        content: "";
        position: absolute;
        inset: 0;
        background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 150 150"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.75" numOctaves="3" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23noise)" opacity="0.08"/></svg>');
        z-index: 10001;
        pointer-events: none;
        animation: flicker 0.15s infinite; /* Add flicker to the noise */
      }
      #loader-overlay::after { /* Scanline */
        content: "";
        position: absolute;
        left: 0;
        top: 0; /* Start animation from top */
        width: 100%;
        height: 4px;
        background: rgba(0, 255, 0, 0.1);
        box-shadow: 0 0 5px rgba(0, 255, 0, 0.2);
        animation: loader-scanline 5s linear infinite;
        z-index: 10002;
        pointer-events: none;
      }

      #crt-line {
        position: absolute;
        width: 100%;
        height: 2px;
        background-color: #00ff00;
        box-shadow: 0 0 8px #00ff00, 0 0 15px #00ff00aa, 0 0 25px #00ff0055;
        transform: scaleY(0.01);
        animation: crt-warmup 0.5s cubic-bezier(0.1, 0.7, 0.3, 1) forwards;
        z-index: 10005; /* Above effects */
      }
      #crt-static { /* Brief flash */
        position: absolute;
        inset: 0;
        background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 150 150"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.95" numOctaves="3" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23noise)" opacity="0.1"/></svg>');
        opacity: 0;
        animation: show-static 0.2s 0.5s forwards; /* Starts after crt-line finishes */
        z-index: 10006; /* Above line */
      }
      #boot-text {
        position: relative; /* Relative to allow absolute positioning of progress */
        font-size: clamp(0.8rem, 1.5vw, 1rem);
        white-space: pre;
        margin: 0;
        opacity: 0;
        line-height: 1.4;
        text-shadow: 0 0 3px #00ff00a0;
        animation: fade-in-text 0.1s 0.7s forwards; /* Starts after static effect */
        z-index: 10003; /* Above effects */
        transition: opacity 0.3s ease-out; /* For fading out */
        padding: 30px; /* Give space around text */
        max-width: 80%;
        text-align: left;
      }
      #cursor {
        background-color: #00ff00;
        animation: blink 1s step-end infinite;
        display: inline-block;
        width: 0.6em;
        height: 1.1em;
        margin-left: 1px;
        vertical-align: bottom;
        box-shadow: 0 0 5px #00ff00;
        transition: opacity 0.3s ease-out;
      }
      #boot-text.hide, #cursor.hide {
        opacity: 0 !important;
      }

      /* Progress Bar Styles */
      #progress-container {
        position: absolute; /* Position relative to #loader-overlay */
        bottom: 15%; /* Position near bottom */
        left: 50%;
        transform: translateX(-50%);
        width: clamp(250px, 50%, 400px); /* Responsive width */
        display: flex; /* Set via JS */
        flex-direction: column;
        align-items: center;
        gap: 15px; /* Space between logo and bar */
        opacity: 0; /* Hidden initially */
        transition: opacity 0.3s ease-in; /* Fade in */
        z-index: 10004; /* Above effects/text */
      }
      #progress-container.show {
        opacity: 1;
      }
      #progress-logo {
        width: 50px; /* Size of the logo */
        height: 50px;
        margin-bottom: 5px; /* Space below logo */
      }
       #progress-logo svg {
         width: 100%;
         height: 100%;
         filter: drop-shadow(0 0 3px #00ff00);
       }
      #progress-bar-outer {
        width: 100%;
        height: 8px;
        border: 1px solid rgba(0, 255, 0, 0.5);
        border-radius: 4px;
        padding: 1px;
        background-color: rgba(0, 0, 0, 0.3);
        overflow: hidden; /* Clip the inner bar */
      }
      #progress-bar-inner {
        width: 0%; /* Start empty */
        height: 100%;
        background-color: #00ff00;
        border-radius: 3px;
        box-shadow: inset 0 0 3px rgba(0,0,0,0.5), 0 0 5px #00ff00;
        transition: width 1.5s cubic-bezier(0.4, 0, 0.2, 1); /* Animation timing */
      }
      #progress-bar-inner.fill {
         width: 100%; /* Target width for animation */
      }

      /* Keyframes must be defined here for inline styles to work */
      @keyframes crt-warmup { /* As before */
        0% { transform: scaleY(0.01) scaleX(0.8); height: 1px; opacity: 0.5; filter: blur(1px); }
        20% { transform: scaleY(0.01) scaleX(1); height: 2px; opacity: 1; filter: blur(0); }
        99% { transform: scaleY(1000) scaleX(1); height: 2px; opacity: 0.5; filter: blur(2px);}
        100% { transform: scaleY(1000) scaleX(1); height: 2px; opacity: 0; filter: blur(2px);}
      }
      @keyframes show-static { /* As before */
        0%, 100% { opacity: 0; }
        50% { opacity: 0.1; }
      }
      @keyframes fade-in-text { /* As before */
        to { opacity: 1; }
      }
      @keyframes blink { /* As before */
        from, to { background-color: transparent; box-shadow: none; }
        50% { background-color: #00ff00; box-shadow: 0 0 5px #00ff00; }
      }
      @keyframes loader-scanline { /* For loader overlay */
          0% { transform: translateY(0%); }
          100% { transform: translateY(100vh); }
      }
      @keyframes flicker { /* Added for loader overlay noise */
        0% { opacity: 0.08; } 5% { opacity: 0.06; } 10% { opacity: 0.09; }
        15% { opacity: 0.07; } 20% { opacity: 0.1; } 80% { opacity: 0.08; }
        85% { opacity: 0.07; } 90% { opacity: 0.09; } 95% { opacity: 0.06; }
        100% { opacity: 0.08; }
      }
    </style>
  </head>
  <body>
    <!-- LOADER MARKUP -->
    <div id="loader-overlay">
      <div id="crt-line"></div>
      <div id="crt-static"></div>
      <pre id="boot-text"><span id="cursor">_</span></pre>
      <!-- Progress Bar Structure -->
      <div id="progress-container" style="display: none;"> <!-- Start hidden -->
        <div id="progress-logo">
           <!-- SVG Favicon -->
           <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
             <rect width="100" height="100" rx="20" ry="20" fill="#051105"/>
             <text x="50%" y="50%" font-size="70" text-anchor="middle" dy=".35em" font-family="Courier, monospace" fill="#00ff00">S.</text>
           </svg>
        </div>
        <div id="progress-bar-outer">
          <div id="progress-bar-inner"></div>
        </div>
      </div>
    </div>
    <!-- END LOADER MARKUP -->

    <!-- React App Mount Point -->
    <div id="root"></div>

    <!-- LOADER CONTROL SCRIPT -->
    <script>
      (function() {
        const LOADER_SESSION_KEY = 'saqinLoaderRan';
        const loaderOverlay = document.getElementById('loader-overlay');
        const bootTextElement = document.getElementById('boot-text');
        const cursorElement = document.getElementById('cursor');
        const progressContainer = document.getElementById('progress-container');
        const progressBarInner = document.getElementById('progress-bar-inner');
        let typeTimeoutId;
        let fallbackTimeoutId;
        let progressTimeoutId;
        let finalHideTimeoutId;

        // --- Navigation Type Check ---
        let navigationType = 'navigate'; // Default
        try {
          const navEntries = performance.getEntriesByType("navigation");
          if (navEntries && navEntries.length > 0) {
            navigationType = navEntries[0].type;
          }
        } catch (e) {
          console.warn("PerformanceNavigationTiming API not supported or failed.", e);
        }

        const loaderRanInSession = sessionStorage.getItem(LOADER_SESSION_KEY) === 'true';

        // --- Conditional Loader Execution ---
        if (loaderRanInSession && navigationType !== 'reload') {
          // Loader already ran in this session, AND this is NOT a reload
          console.log(`Skipping loader: Already ran (session) and navigation type is "${navigationType}".`);
          if (loaderOverlay) loaderOverlay.style.display = 'none'; // Hide immediately
          return; // Exit script
        }
        // --- End Conditional Loader Execution ---

        // --- Proceed with Loader Animation (First load OR Reload) ---
        console.log(`Running loader animation: First load or reload (type: "${navigationType}").`);

        const bootLines = [
          "INITIATING BIOS...",
          "RAM CHECK: 16384MB OK",
          "CPU: Quantum Entangler @ 5.0 THz",
          "LOADING CORE MODULES [REACT v18.3]...",
          "MOUNTING VIRTUAL DOM...",
          "ESTABLISHING SECURE LINK...",
          "USER AUTH: S.NOOR",
          "ACCESS GRANTED.",
          "",
          ">> DEPLOYING INTERFACE...",
          ""
        ];
        let lineIndex = 0;
        let charIndex = 0;

        function hideLoader() {
          if (loaderOverlay) {
            document.body.classList.add('loaded');
            // Set the flag AFTER the animation completes successfully
            sessionStorage.setItem(LOADER_SESSION_KEY, 'true');
            // Optional delay before removing element
            setTimeout(() => {
                if (loaderOverlay) loaderOverlay.remove(); // Remove instead of just hide
            }, 700); // Match CSS fade duration + buffer
          }
        }

        function startProgressBar() {
          if (!progressContainer || !progressBarInner || !bootTextElement || !cursorElement) return;

          bootTextElement.classList.add('hide');
          cursorElement.classList.add('hide');

          progressContainer.style.display = 'flex'; // Make container visible
          requestAnimationFrame(() => { // Force reflow for transition
            progressContainer.classList.add('show'); // Start fade-in
          });

          progressTimeoutId = setTimeout(() => {
            progressBarInner.classList.add('fill'); // Start width animation
            finalHideTimeoutId = setTimeout(hideLoader, 1600); // Hide after bar fills + buffer
          }, 400); // Delay after showing container
        }

        function typeChar() {
          if (!bootTextElement || !cursorElement) return;

          if (lineIndex >= bootLines.length) {
            startProgressBar();
            return;
          }

          const currentLine = bootLines[lineIndex];
          if (charIndex < currentLine.length) {
            const textNode = document.createTextNode(currentLine[charIndex]);
            bootTextElement.insertBefore(textNode, cursorElement);
            charIndex++;
            typeTimeoutId = setTimeout(typeChar, Math.random() * 30 + 5);
          } else {
            bootTextElement.insertBefore(document.createElement('br'), cursorElement);
            lineIndex++;
            charIndex = 0;
            const delay = (currentLine.includes("GRANTED") || lineIndex === bootLines.length -1) ? 200 : Math.random() * 40 + 40;
            typeTimeoutId = setTimeout(typeChar, delay);
          }
        }

        // Delay typing start
        const startTypingDelay = 700;
        setTimeout(typeChar, startTypingDelay);

        // Fallback timer
        const maxLoadTime = 8000;
        fallbackTimeoutId = setTimeout(() => {
           if (!document.body.classList.contains('loaded')) {
               console.warn("Loader fallback timeout triggered.");
               clearTimeout(typeTimeoutId);
               clearTimeout(progressTimeoutId);
               clearTimeout(finalHideTimeoutId);
               hideLoader(); // Force hide and set session flag
           }
        }, maxLoadTime);

        // Cleanup
        window.addEventListener('beforeunload', () => {
          clearTimeout(typeTimeoutId);
          clearTimeout(fallbackTimeoutId);
          clearTimeout(progressTimeoutId);
          clearTimeout(finalHideTimeoutId);
        });

      })();
    </script>
    <!-- END LOADER CONTROL SCRIPT -->

    <!-- Main React application script -->
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>